<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="Author" content="Dan Peirce (B.Sc.)">
   <meta name="GENERATOR" content="Mozilla/4.79 [en] (Windows NT 5.0; U) [Netscape]">
   <title>Photogete Project Prototype</title>
</head>
<body text="#000000" bgcolor="#FFFFFF" link="#0000EE" vlink="#551A8B" alink="#FF0000">

<center><b><font size=+2>Photogate Project Prototype</font></b>
<br>by Dan Peirce
<br>for Mike Coombes
<br>(<a href="../SensorsNotesIndex.html">link to sensor notes index page</a>)
<br>
<hr WIDTH="100%">
<br><b>Latest update to this page is below the introduction <a href="#latest_update">&lt;link></a></b>
<hr WIDTH="100%">
<p><b>Introduction ( rev. July 6, 2007; first posted October 4, 2006 )</b></center>

<p><br>
<center><table WIDTH="80%" >
<tr>
<td>The new boxes will attach to the computer via the USB and have the
same connector as the PICkit2.
<p>They can <b>work with</b> <b>LABview </b>(as is Mike's intention) and
they <b>can also</b> work <b>with</b> <b>hyperterminal</b> as they look
like a virtual com port and can be assigned any unused comX number via
the control panel.
<p>The box contains a PIC18F4525 programmable microcontroller (single chip
microcomputer with built in I/O).
<br>
<hr WIDTH="100%">
<br>Having build this prototype I'd suggest using a bigger box so that
the sparkfun board can be mounted on the inside rather than on the outside.
I used long wires so that the PIC board could be removed for future modifications.
I'd suggest keeping the wires much shorter and using connectors to make
the board removable.&nbsp;
<p>An alternate suggestion would be to mount the circuit boards on a piece
of sintra and use spaces to mount a piece of Plexiglas (or another piece
of sintra) above to provide a window in. If the connectors were all mounted
at the edges of the bottom sintra board facing outward no holes would have
to be drilled/ made which would save a lot of time.
<p>In June 2007 a external crystal oscillator was added to the project
to eliminate <a href="http://cp.literature.agilent.com/litweb/pdf/5989-5718EN.pdf">jitter</a>
and inconsistencies in the frequency from the internal oscillator PLL combination.</td>
</tr>
</table></center>

<center>
<p>Info on the <b>sparkfun USB board</b>&nbsp; see notes at
<br><a href="http://www.kwantlen.ca/science/physics/faculty/dpeirce/notes/sparkfun.html">http://www.kwantlen.ca/science/physics/faculty/dpeirce/notes/sparkfun.html</a>
<p>The <b>XP, win98se</b>, MAC and Linux&nbsp; <b>drivers</b> can be found
here
<br><a href="http://www.ftdichip.com/Drivers/VCP.htm">http://www.ftdichip.com/Drivers/VCP.htm</a>
<br>&nbsp;
<p>Showing USB connection&nbsp;<img SRC="box_usb.jpg" height=470 width=574 align=ABSCENTER>
<p><img SRC="box_to_PICkit2.jpg" height=713 width=640>
<br>Removable pins can be used to connect to PICkit2 for updating firmware!
<br>
<hr WIDTH="100%">
<br><a NAME="latest_update"></a></center>

<center><table BORDER CELLPADDING=8 WIDTH="85%" >
<tr>
<td>July 6, 2007</td>
</tr>

<tr>
<td>At this time we are going with an external crystal oscillator as an
expediency.
<p>Application note <a href="http://ww1.microchip.com/downloads/en/AppNotes/00949a.pdf">http://ww1.microchip.com/downloads/en/AppNotes/00949a.pdf

</a>gives more background on getting the crystal HS oscillator functioning.</td>
</tr>
</table></center>

<center><table BORDER CELLPADDING=8 WIDTH="85%" >
<tr>
<td>June 27, 2007</td>
</tr>

<tr>
<td>The oscillator module is working at 32 MHz.
<p>To get the PIC programmed I had to <b>program it without attaching the
oscillator first.</b>
<br>Since the oscilator it self is self contained it does work on a bread
board. This is good. We could use these in labs too.
<br>The frequency looks rock solid which is what we are wanting in a timer.
<p>I used a variation of the flash program to toggle D0 a bunch of times
and then sit for a 0.5 second delay (makes triggering the digital scope
easy).
<p>If we were going to mass produce this it would be more cost effective
to go with a crystal but as it is I think the crystal oscilator (in a package)
is going to save us a lot of trouble so it is worth the extra cost to us.
$2 to $3 each rather than $0.60 each.
<p><b>The circuit is</b>
<br><b>+5 to pin 1 and pin 8</b>
<br><b>gnd to pin 4</b>
<br><b>output from crystal osc on pin 5 (goes to pin 13 of PIC).</b>
<p>Used Osc = <b>EC</b>&nbsp;&nbsp;&nbsp; //&nbsp;&nbsp; (external clock).
<p><b>The osc freq can be seen in the lower right as 31.9998 MHz</b>
<br><img SRC="imageDL5.JPG" height=635 width=828>
<p><b>The OSC/4 frequency is 7.99994 MHz measured</b>
<br><img SRC="image89S.JPG" height=578 width=744>
<p><b>look at the delta time between the cursors the instruction rate is
125.0 ns measured</b>
<br><img SRC="image5BK.JPG" height=561 width=692></td>
</tr>
</table></center>

<center><table BORDER CELLPADDING=8 WIDTH="85%" >
<tr>
<td>June 22, 2007</td>
</tr>

<tr>
<td>Mike brought a prototype box to Richmond. I fixed a lead that had broken
off the programing connector.
<p>After shorting out the 1K resistor in the oscillation circuit I was
able to get it to oscillate but is was at 14 MHz rather than 40MHz and
the output seemed small. I rebuilt the circuit twice and did not get it
to function.
<p>This is simply taking too long so to avoid wasting more time I have
decided to go ahead and order 32 MHz crystal oscillators. Mike would like
a 32 MHz oscillator because the frequency has been working well for the
USART communications (the existing program with the internal oscillator
and PLL operates at 32 MHz so no changes to existing code would be required.
<p>Epson Toyocom Corporation
<br>SG-531PH 32.0000MC
<br><a href="32MHzOsc.pdf">see datasheet</a>
<center>
<p><img SRC="image61P.JPG" VSPACE=2 BORDER=4 height=258 width=377></center>
<img SRC="imageBR5.JPG" VSPACE=2 BORDER=4 height=563 width=881>
<br><img SRC="image43F.JPG" height=560 width=540>
<p>
<hr WIDTH="100%">
<br>will also look at a <a href="40MHzOsc.pdf">40 MHz oscillator</a>.
<br>&nbsp;</td>
</tr>
</table></center>

<br>&nbsp;
<center><table BORDER CELLPADDING=8 COLS=1 WIDTH="85%" >
<tr>
<td>June 11. 2007</td>
</tr>

<tr>
<td>I have put the 10 MHz crystal (see June08) on order but have decided
to also purchase a 40 MHz crystal <a href="40MHz_Xtal.pdf">&lt;Datasheet></a>
<br>After talking to Mike I will also be getting a 32 MHz crystal (same
datasheet).
<p>Note this is a 3rd overtone crystal <a href="ApplicationNote00826a.pdf">&lt;see
application note>.</a> The following is from the datasheet
<br><img SRC="imageSSD.JPG" height=513 width=832>
<p>The following is from Digikey
<p><img SRC="imageC53.JPG" height=580 width=537>
<p>The following is for the 32 MHz crystal (same datasheet as 40 MHz crystal
above).
<p><img SRC="imageETA.JPG" height=606 width=535></td>
</tr>
</table></center>

<center>
<p>June 08, 2007</center>

<p><br>
<center><table WIDTH="80%" >
<tr>
<td>Up until now the photogate timer boxes have been using the PIC18F4525
internal oscillator set to 32 MHz. The frequency could be adjusted on the
units and was somewhat stable but only if the timer box was always run
on the same computer since the frequency was voltage dependent. We are
considering adding crystals to the timers to make them more stable. I have
tentatively selected the following crystal
<center><a href="008-0309-0_C.pdf">&nbsp;</a><a href="10MHz_Xtal.pdf">MP101
(datasheet -- some parameters from datasheet below)</a>
<br><img SRC="image68E.JPG" height=51 width=679>
<br><img SRC="imageICR.JPG" height=208 width=583>
<p>From Digikey web page
<br><a href="10MHz_Xtal.pdf"><img SRC="imageBPS.JPG" VSPACE=2 BORDER=4 height=561 width=550></a></center>
</td>
</tr>
</table></center>

<br>&nbsp;
<br>&nbsp;
<center>
<p>
<hr WIDTH="100%">
<br><b>October 4, 2006</b></center>

<center><table WIDTH="80%" >
<tr>
<td>Just tested box under XP. It worked the same except there was activity
reported for the photogates if they were not attached. I expect this can
be attributed to noise at the inputs when no signal is attached. It works
as before when both photogate plugs are inserted. As a quick solution for
the prototype I have made two dummies which can be inserted when no photogate
is present. In future units I suggest installing the dummies on the board
as pull-ups.
<center>
<p><img SRC="dummy_open.jpg" height=616 width=417>
<p><img SRC="dummy_in2.jpg" height=442 width=600></center>
</td>
</tr>
</table></center>

<center>
<p>
<hr WIDTH="100%">
<br><a NAME="diagnosticprogram"></a><b>October 3, 2006</b>
<p>Tested photogate box with <b>diagnostic program</b>
<p><a href="diagnostic_timer_box.c">source code</a>&nbsp; |||&nbsp; <a href="diagnostic_timer_box.hex">hex
file</a>
<p><img SRC="diagnostic_timer_box_photo.jpg" height=631 width=800>
<p><img SRC="diagnostic_timer_box_shot.jpg" height=568 width=412>
<br>
<hr WIDTH="100%">
<br>Sept. 29, 2006
<p>Small LED's have been mounted on cover (one green one red). They are
not on here (just the reflection from the flash).
<br><img SRC="with_leds.jpg" height=362 width=516>
<br>&nbsp;
<p>Tested one of the photogate inputs. Photo here shows box open and board
pulled out. Used 32bit timer capture program from June. Will write a little
diagnostic to test box features including leds and both timer inputs.
<p>I'd use a different box on another one. Here there are long wires so
the board can be removed. It would be better to have connectors and short
wires. Also rather than have the jacks on the lid I'd put them on a front
panel next time.
<br><img SRC="wiring_testing.jpg" height=450 width=600>
<br>&nbsp;
<p>
<hr WIDTH="100%">
<br>Sept. 25, 2006
<br>completed wiring from sparkfun board and from programming connector
(have not yet wired LED's or photogate jacks).
<br>Tested programming and virtual RS232 connection.
<p>Note:
<br>Today the sparkfun board came up as com5. It was changed back to com4
using the device manager.
<br>PIC board inserts into box -- once wiring complete.
<p><img SRC="test_programming.jpg" height=343 width=600></center>

<p><br>
<br>
<br>
<br>
<br>
<p>
<hr WIDTH="100%">
<center>
<p><img SRC="box_usb_jack.jpg" height=317 width=633>
<br><b>Sept. 19, 2006</b> Finished mounting of USB board from Sparkfun.</center>

<p><br>
<br>
<br>
<p>
<hr WIDTH="100%">
<br><b>Sept. 18, 2005</b>
<blockquote>
<center><img SRC="parts_of_timer.jpg" height=647 width=922>
<p><img SRC="box_board.jpg" height=623 width=800>
<p><img SRC="box_board_mounted.jpg" height=645 width=350></center>
</blockquote>

</body>
</html>
